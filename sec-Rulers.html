<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
<title>9.7. Les règles</title>
<link rel="stylesheet" href="pygtktutfr.css">
<meta name="keywords" content="python,pygtk,tutoriel,traduction,regle">
<link rel="start" href="index.html" title="Tutoriel PyGTK 2.0">
<link rel="home" href="index.html" title="Table des matières">
<link rel="up" href="ch-MiscellaneousWidgets.html" title="Chapitre 9. Widgets divers">
<link rel="previous" href="sec-Images.html" title="9.6. Les images">
<link rel="next" href="sec-Statusbars.html" title="9.8. La barre d'état">
</head>

<body>
<div class="navheader">
<table width="100%" summary="En-tête de navigation">
<tr>
<th colspan="3" align="center">9.7. Les règles</th>
</tr><tr>
<td width="20%" align="left"><a accesskey="p" href="sec-Images.html">Préc.</a></td>
<th width="60%" align="center">Chapitre 9. Widgets divers</th>
<td width="20%" align="right"><a accesskey="n" href="sec-Statusbars.html">Suiv.</a></td>
</tr></table>

<hr>
</div>

<div class="sect1"><div class="titlepage"><div>
<h2 class="title" style="clear: both"><a name="Regles"></a>9.7. Les règles</h2></div></div>

<p>Le widget <tt>gtk.Ruler</tt> sert à indiquer la position du pointeur de la souris
dans une fenêtre donnée. Une fenêtre peut être dotée d'une
règle horizontale s'étendant sur sa largeur et d'une verticale dans sa hauteur.
La position exacte du pointeur mesurée par la règle est
matérialisé sur celle-ci par un petit indicateur triangulaire.</p>
<p>Le widget doit tout d'abord être créé. On utilisera à cet
effet les fonctions suivantes&nbsp;:</p>

<pre class="programlisting">
  regle_h = gtk.HRuler()    # crée une règle horizontale

  regle_v = gtk.VRuler()    # crée une règle verticale
</pre>

<p>Une fois qu'une règle est créée, on peut définir
l'unité de mesure&nbsp;: <tt>PIXELS</tt> (pixels), <tt>INCHES</tt> (pouces)
ou <tt>CENTIMETERS</tt> (centimètres). La méthode à utiliser est
la suivante&nbsp;:</p>

<pre class="programlisting">
  regle.set_metric(<b><tt>metric</tt></b>)
</pre>

<p>L'unité de mesure par défaut est <tt>PIXELS</tt>.</p>

><pre class="programlisting">
  regle.set_metric(gtk.PIXELS)
</pre>

<p>Les gtk.Ruler possèdent d'autres caractéristiques configurables,
telles que la graduation de l'intervalle choisi et la position initiale de l'indicateur.
Ces deux options se définissent avec la méthode suivante&nbsp;:</p>

<pre class="programlisting">
  regle.set_range(<b><tt>lower</tt></b>, <b><tt>upper</tt></b>, <b><tt>position</tt></b>,<b><tt> max_size</tt></b>)
</pre>

<p>Les arguments <i><tt>lower</tt></i> (minimum) et <i><tt>upper</tt></i> (maximum)
spécifient l'étendue de la règle, et <i><tt>max_size</tt></i>
(taille maximum) représente le plus grand nombre qui puisse être affiché.
Quant à <i><tt>position</tt></i>, il précise la position initiale de
l'indicateur triangulaire dans la règle.</p>
<p>On peut donc faire s'étendre une règle verticale sur une fenêtre
de 800 pixel de haut ainsi&nbsp;:</p>

<pre class="programlisting">
  regle_v.set_range(0, 800, 0, 800)
</pre>

<p>Les graduations de la règle iront de 0 à 800, avec un nombre tous les
100 pixels. Si l'on voulait que la règle aille de 7 à 16, on coderait
plutôt&nbsp;:</p>

<pre class="programlisting">
  regle_v.set_range(7, 16, 0, 20)
</pre>

<p>L'indicateur, petite marque triangulaire présente sur la règle, indique
la position du pointeur mesurée par cette dernière. Si l'on utilise
une règle dans le but de suivre le pointeur de la souris, le signal
"<tt>motion_notify_event</tt>" (évènement "notification
de mouvement") devrait être connecté à la méthode
"<tt>motion_notify_event</tt>" de la règle. Il nous faut définir
une fonction de rappel du "<tt>motion_notify_event</tt>" pour la zone de dessin
et utiliser <tt>connect_object</tt>() pour faire émettre à la règle
un signal de notification de mouvement&nbsp;:</p>

<pre class="programlisting">
  def notif_mouvement(regle, evnmt):
      return regle.emit("motion_notify_event", evnmt)

  zonedess.connect_object("motion_notify_event", notif_mouvement, regle)
</pre>

<p>Le programme d'exemple <a href="exemples/regles.py" target="_top"><b>regles.py</b></a>
crée une zone de dessin encadrée par une règle horizontale en haut
et une verticale à gauche. La zone de dessin fait 600 pixels de large pour 800
pixels de haut. La règle horizontale est graduée de 7 à 13 avec
une marque tous les 100 pixels, tandis que la règle verticale est graduée
de 0 à 400 avec une marque tous les 100 pixels. Le placement de la zone de dessin
ainsi que des règles est effectué au moyen d'un tableau. La
<a href="sec-Rulers.html#FigRegles"
title="Figure 9.8. Exemple de règles">Figure 9.8</a> montre le
résultat&nbsp;:</p>

<div class="figure"><a name="FigRegles"></a>
<p class="title"><b>Figure 9.8. Figure 9.8. Exemple de règles</b></p>
<div class="mediaobject" align="center">
<img src="figures/regles.png" align="middle" alt="exemple régles">
</div></div>

<p>Le code source de <a href="exemples/regles.py" target="_top"><b>regles.py</b></a>
est le suivant&nbsp;:</p>

<pre class="programlisting">
     1   #!/usr/bin/env python
     2
     3   # exemple regles.py
     4
     5   import pygtk
     6   pygtk.require('2.0')
     7   import gtk
     8
     9   class ExempleRegles:
    10       TAILLE_X = 400
    11       TAILLE_Y = 400
    12
    13       # Cette routine prend le controle lorsque on clique sur le bouton fermer
    14       def fermer_application(self, widget, evnmt, data=None):
    15           gtk.main_quit()
    16           return False
    17
    18       def __init__(self):
    19           fenetre = gtk.Window(gtk.WINDOW_TOPLEVEL)
    20           fenetre.connect("delete_event", self.fermer_application)
    21           fenetre.set_border_width(10)
    22
    23           # Creation d'un tableau pour le placement des regles et de la zone de dessin
    24           tableau = gtk.Table(3, 2, False)
    25           fenetre.add(tableau)
    26
    27           zonedess = gtk.DrawingArea()
    28           zonedess.set_size_request(self.TAILLE_X, self.TAILLE_Y)
    29           tableau.attach(zonedess, 1, 2, 1, 2,
    30                          gtk.EXPAND|gtk.FILL, gtk.FILL, 0, 0)
    31           zonedess.set_events(gtk.gdk.POINTER_MOTION_MASK |
    32                               gtk.gdk.POINTER_MOTION_HINT_MASK )
    33
    34           # La regle horizontale va en haut. Quand la souris passe dans la zone de dessin,
    35           # un "motion_notify-event" est transmis au gestionnaire d'evenement approprie,
    36           # qui le passe a son tour a la regle.
    37           regle_h = gtk.HRuler()
    38           regle_h.set_metric(gtk.PIXELS)
    39           regle_h.set_range(7, 13, 0, 20)
    40           def notif_mouvmt(regle, evnmt):
    41               return regle.emit("motion_notify_event", evnmt)
    42           zonedess.connect_object("motion_notify_event", notif_mouvmt, regle_h)
    43           tableau.attach(regle_h, 1, 2, 0, 1,
    44                          gtk.EXPAND|gtk.SHRINK|gtk.FILL, gtk.FILL, 0, 0 )
    45
    46           # La regle verticale va a gauche. Quand la souris passe dans la zone de dessin,
    47           # un "motion_notify-event" est transmis au gestionnaire d'evenement approprie,
    48           # qui le passe a son tour a la regle.
    49           regle_v = gtk.VRuler()
    50           regle_v.set_metric(gtk.PIXELS)
    51           regle_v.set_range(0, self.TAILLE_Y, 10, self.TAILLE_Y)
    52           zonedess.connect_object("motion_notify_event", notif_mouvmt, regle_v)
    53           tableau.attach(regle_v, 0, 1, 1, 2,
    54                          gtk.FILL, gtk.EXPAND|gtk.SHRINK|gtk.FILL, 0, 0 )
    55
    56           # On affiche tout
    57           zonedess.show()
    58           regle_h.show()
    59           regle_v.show()
    60           tableau.show()
    61           fenetre.show()
    62
    63   def main():
    64       gtk.main()
    65       return 0
    66
    67   if __name__ == "__main__":
    68       ExempleRegles()
    69       main()
</pre>

<p>Les lignes 42 et 52 connectent la fonction de rappel <tt>notif_mouvmt</tt>()
à la zone de dessin, la première ligne passant <i><tt>regle_h</tt></i>
et la seconde <i><tt>regle_v</tt></i> comme données utilisateur. La fonction de
rappel <tt>notif_mouvmt</tt>() sera invoquée deux fois à chaque mouvement
de la souris&nbsp;: une fois avec <i><tt>regle_h</tt></i> et une autre avec
<i><tt>regle_v</tt></i>.</p>
</div>

<div class="navfooter">
<hr>

<table width="100%" summary="Bas de page de navigation">
<tr>
<td width="40%" align="left"><a accesskey="p" href="sec-Images.html">Préc.</a></td>
<td width="20%" align="center"><a accesskey="u" href="ch-MiscellaneousWidgets.html">Chapitre parent</a></td>
<td width="40%" align="right"><a accesskey="n" href="sec-Statusbars.html">Suiv.</a></td>
</tr><tr>
<td width="40%" align="left" valign="top">9.6. Les images</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Table des matières</a></td>
<td width="40%" align="right" valign="top">9.8. La barre d'état</td>
</tr></table></div>

</body>

</html>
